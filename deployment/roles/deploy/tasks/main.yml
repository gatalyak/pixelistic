- name: Open firewall ports
  firewalld:
    port: "80/tcp"
    immediate: yes
    permanent: true
    state: enabled
- name: Recursively remove app directory
  file:
    path: /opt/app
    state: absent
- name: Create app directory
  file: path=/opt/app state=directory
- name: Copy app files with owner and permissions
  copy:
    src: ./../pixelistic_fe/build
    dest: /opt/app/pixelistic_fe
- name: tar
  local_action: command tar zcvf ./../pixelistic_be.tgz ./../pixelistic_be
- name: Copy app files with owner and permissions
  copy:
    src: ./../pixelistic_be.tgz
    dest: /opt/app/
- name: untar
  command: tar -C /opt/app -xvzf /opt/app/pixelistic_be.tgz
- name: Running backend
  debug:
#  msg: "{{ MONGO_DB }}"
  shell: "cd /opt/app/pixelistic_be && nohup node ./bin/www &"
  environment:
    FRONT_URL: "{{ FRONT_URL }}"
    AWS_ACCESS_KEY_ID: "{{ AWS_ACCESS_KEY_ID }}"
    AWS_SECRET_ACCESS_KEY: "{{ AWS_SECRET_ACCESS_KEY }}"
    MONGO_DB: "{{ MONGO_DB }}"
    EMAIL_USER: "{{ EMAIL_USER }}"
    EMAIL_PASS: "{{ EMAIL_PASS }}"
      

   



